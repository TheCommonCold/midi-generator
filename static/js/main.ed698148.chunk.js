(this["webpackJsonpmidi-generator"]=this["webpackJsonpmidi-generator"]||[]).push([[0],{115:function(t,e,n){},118:function(t,e,n){"use strict";n.r(e);var r=n(7),o=n(0),a=n.n(o),c=n(17),i=n.n(c),s=(n(93),n(10)),h=n(11),u=n(150),l=n(149),m=n(154),j=n(23),d=n(159),f=n(74),b=n.n(f),p=n(78),g=n.n(p);function O(t){var e=t.progression,n=Object(o.useState)([]),a=Object(h.a)(n,2),c=a[0],i=a[1];return Object(o.useEffect)((function(){for(var t=Math.max.apply(Math,Object(s.a)(e.notes.map((function(t){return Math.max.apply(Math,Object(s.a)(t.chord.map((function(t){return t.hight}))).concat([t.root.hight]))})))),n=Math.min.apply(Math,Object(s.a)(e.notes.map((function(t){return Math.min.apply(Math,Object(s.a)(t.chord.map((function(t){return t.hight}))).concat([t.root.hight]))})))),o=[],a=0,c=0;c<e.rythm.length;c++)a+=e.rythm[c];for(var h=0;h<e.notes.length;h++){for(var u=[].concat(Object(s.a)(e.notes[h].chord),[e.notes[h].root]).map((function(t){return t.hight})),l=[],m=n;m<=t;m++)u.includes(m)?l.push(Object(r.jsx)("div",{style:{height:(1/(t-n+1)*100).toString()+"%",width:"100%",backgroundColor:"#c62828"}},h.toString()+m.toString())):l.push(Object(r.jsx)("div",{style:{height:(1/(t-n+1)*100).toString()+"%",width:"100%"}},h.toString()+m.toString()));o.push(Object(r.jsx)("div",{style:{height:"100%",width:(e.rythm[h]/a*100).toString()+"%"},children:l.reverse()},h))}i(o)}),[e]),Object(r.jsx)(l.a,{className:"w-100 m-0 h-100",children:c})}var v=a.a.memo(O),y="ADD_SPECIMAN",x="SET_SPECIMAN_SCORE",w="DELETE_POPULATION",M=function(t){return{type:y,payload:{speciman:t}}},S=function(){return{type:w}};function N(t){var e=t.progression,n=t.index,o=Object(j.b)();return Object(r.jsxs)(u.a,{className:"p-0 h-100",children:[Object(r.jsxs)(l.a,{className:"w-100 m-0 h-75",children:[Object(r.jsx)(v,{color:"#c62828",progression:e}),Object(r.jsx)("div",{className:"vote",onClick:function(){e.play()},children:Object(r.jsx)(b.a,{style:{fontSize:80},className:"vote-text"})}),Object(r.jsx)("div",{className:"download",onClick:function(){e.download()},children:Object(r.jsx)(g.a,{style:{fontSize:20},className:"vote-text"})})]}),Object(r.jsxs)(l.a,{children:[Object(r.jsx)(m.a,{sm:3,children:Object(r.jsx)("small",{children:"Score"})}),Object(r.jsx)(m.a,{sm:1,className:"pl-2",children:Object(r.jsx)("small",{children:e.score})}),Object(r.jsx)(m.a,{className:"pl-2",children:Object(r.jsx)(d.a,{"aria-labelledby":"discrete-slider",valueLabelDisplay:"auto",min:0,max:100,onChange:function(t,e){o(function(t){var e=t.index,n=t.score;return{type:x,payload:{index:e,score:n}}}({index:n,score:e}))},value:e.score})})]})]})}var k=a.a.memo(N),C=n(155);var E=function(){var t=Object(j.c)((function(t){return t.population})),e=Object(o.useState)([]),n=Object(h.a)(e,2),a=n[0],c=n[1];return Object(o.useEffect)((function(){for(var e=Object(s.a)(t),n=[];e.length;)n.push(e.splice(0,4));c(n)}),[t]),Object(r.jsx)(C.a,{children:Object(r.jsx)(u.a,{children:a.map((function(t,e){return Object(r.jsx)(l.a,{children:t.map((function(t,n){return Object(r.jsx)(m.a,{style:{height:"200px"},children:Object(r.jsx)(k,{progression:t,index:4*e+n})},n)}))},e)}))})})},z=n(26),A=n(4),I=n(157),L=n(158),D=n(1),P=n(2),T=function t(e,n,r){Object(D.a)(this,t);var o=e.map((function(t){return t.chord}));o.flat()||(o=e.map((function(t){return t.root})));var a=n.reduce((function(t,e){return t+e}));this.scale=r,this.length=a,this.switches=n.length},F=[1/8,1/4,.5,3/4,1,2,3,4];function R(t){for(var e=[],n=t;0!==n;)for(var r=W.length-1;r>=0;r--){var o=1/parseInt(W[r]);if(n>=o){e.push(W[r]),n-=o;break}}return e}var W=["64","32","16","8","4","2","1"];function G(t,e){for(var n=0,r=[],o=0,a=e.max,c=e.min;n<t;){var i=0,s=Math.floor(Math.random()*(a-c))+c;if(Math.random()<.4&&0!==o?s=o:o=s,n+F[s]-i>t)return i=t-n,r.push({rythm:i,beginning:n}),n+=i,r;r.push({rythm:F[s]-i,beginning:n}),n+=F[s]-i}return r}var J=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],B=function(){function t(e,n,r){Object(D.a)(this,t),this.hight=e,this.start=n,this.end=n+r,this.duration=r;var o=Math.floor(e/12),a=J[e%12];this.note=a+o.toString()}return Object(P.a)(t,[{key:"existsInWindow",value:function(t){return t[0]>this.start&&t[0]<this.end||t[1]>this.start&&t[1]<=this.end}}]),t}(),_="major",q="minor",Q={major:{notes:[0,2,4,5,7,9,11],mode:[_,q,q,_,_,q,q]}},U={major:[0,4,7,2,11,6,9,1,8,3,10,5],minor:[0,3,7,2,10,5,9,4,11,6,8,1]};function Y(t,e,n,r){var o=Q[e],a=Math.floor(Math.random()*o.notes.length),c=o.mode[a],i=o.notes[a];if(0===n)return{root:i+=36,chord:[]};var s=function(t,e,n,r){for(var o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:5,a=arguments.length>5?arguments[5]:void 0,c=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,i=[],s=0,h=0;h<n;h++){var u=Math.floor(Math.random()*o+Math.floor(s/(2*o))),l=U[e][u];l+=t,Math.random()<u/(1+a)/12-c&&(l+=12),Math.random()<l/2*(1+a)/12-c&&0!==u&&(l-=12),!i.includes(l)&&r.includes(l%12)?(s=0,i.push(l)):(s++,h--)}return i}(i,c,n,o.notes,r,t).map((function(e){return e+12*(3+t)}));return Math.random()-1/4>i/12&&(i+=12),{chord:s,root:i+12}}var H=n(40),K=new H.b(.2).toDestination(),V=new H.a({frequency:1e3,type:"lowpass",rolloff:-12,Q:0}).connect(K),X=0,Z=120;function $(t){X=t}function tt(){return Z}var et=new H.c(H.d,{oscillator:{count:2,spread:5,type:"sawtooth"},envelope:{attack:.002,decay:0,sustain:1,release:.1}}).connect(V),nt=n(62),rt=n.n(nt),ot=n(79),at=n.n(ot);function ct(t,e){for(var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3?arguments[3]:void 0,o=0,a=[],c=G(r,n),i=Math.floor(12*Math.random()),s=function(n){var r=Y(o,"major",e-1,t);a.push({chord:r.chord.map((function(t){return new B(t+i,c[n].beginning,c[n].rythm)})),root:new B(r.root+i,c[n].beginning,c[n].rythm)})},h=0;h<c.length;h++)s(h);var u=new T(a,c,i);return new it({notes:a,rythm:c.map((function(t){return t.rythm})),genome:u})}var it=function(){function t(e){var n=e.rythm,r=e.genome,o=e.score,a=void 0===o?10:o,c=e.notes;Object(D.a)(this,t),this.notes=c,this.rythm=n,this.genome=r,this.score=a}return Object(P.a)(t,[{key:"getAllNotes",value:function(){return this.notes.map((function(t){return[].concat(Object(s.a)(t.chord),[t.root])})).flat()}},{key:"play",value:function(){if(!X){$(1);for(var t=0,e=this.getAllNotes(),n=H.e(),r=0;r<e.length;r++)et.triggerAttack(e[r].note,n+2*e[r].start*120/tt()),et.triggerRelease([e[r].note],n+2*e[r].end*120/tt()),e[r].end>t&&(t=e[r].end);setTimeout((function(){$(0)}),2*t*1e3*120/tt())}}},{key:"compare",value:function(t){for(var e=t.getAllNotes().map((function(t){return JSON.stringify(t)})),n=this.getAllNotes().map((function(t){return JSON.stringify(t)})),r=0,o=0;o<e.length;o++)n.includes(e[o])&&r++;return r===e.length}},{key:"download",value:function(){for(var t=new rt.a.Track,e=0;e<this.notes.length;e++)t.addEvent([new rt.a.NoteEvent({pitch:[].concat(Object(s.a)(this.notes[e].chord.map((function(t){return t.note}))),[this.notes[e].root.note]),duration:R(this.rythm[e])})],(function(t,e){return{sequential:!1}}));var n,r=new rt.a.Writer(t);n=new Blob([r.buildFile()],{type:"audio/midi"}),at.a.saveAs(n,"midi")}},{key:"transpose",value:function(e){var n=e-this.genome.scale,r=this.notes.map((function(t){return{chord:t.chord.map((function(t){return new B(t.hight+n,t.start,t.duration)})),root:new B(t.root.hight+n,t.root.start,t.root.duration)}})),o=new T(r,this.rythm,this.genome.scale+n);return new t(Object(A.a)(Object(A.a)({},this),{},{genome:o,notes:r}))}},{key:"mutate",value:function(t,e){this.mutateScale();return this.mutateRythm(.1,t,e),this.mutateMelody(.1,t)}},{key:"mutateMelody",value:function(e,n){for(var r=this,o=[],a=[],c=0,i=function(t){if(Math.random()<e&&t<r.rythm.length-1){var i=Y(0,"major",r.notes[0].chord.length,n),s=new B(i.root+r.genome.scale,c,r.rythm[t]),h=i.chord.map((function(t){return t+r.genome.scale}));return a.push({chord:h.map((function(e){return new B(e,c,r.rythm[t])})),root:new B(s.hight,c,r.rythm[t])}),o.push(r.rythm[t]),c+=r.rythm[t],"continue"}o.push(r.rythm[t]),c+=r.rythm[t],a.push(r.notes[t])},s=0;s<this.rythm.length;s++)i(s);var h=new T(a,o,this.genome.scale);return new t(Object(A.a)(Object(A.a)({},this),{},{genome:h,notes:a,rythm:o}))}},{key:"mutateScale",value:function(){var t=Math.floor(3*Math.random())-1+this.genome.scale;return this.transpose(t)}},{key:"mutateRythm",value:function(e,n,r){var o=this.joinChord(e,n),a=Object(h.a)(o,2),c=a[0],i=a[1],s=new t(Object(A.a)(Object(A.a)({},this),{},{notes:i,rythm:c})).breakChord(e,n,r),u=Object(h.a)(s,2),l=u[0],m=u[1],j=new T(m,l,this.genome.scale);return new t(Object(A.a)(Object(A.a)({},this),{},{genome:j,notes:m,rythm:l}))}},{key:"breakChord",value:function(t,e,n){for(var r=this,o=[],a=[],c=0,i=n.max,s=n.min,h=function(n){var h=[];if(F.forEach((function(t,e){t<r.rythm[n]&&e<i&&e>=s&&h.push(t)})),Math.random()<t&&h.length>0){var u=h[Math.floor(Math.random()*h.length)],l=Y(0,"major",r.notes[0].chord.length,e),m=new B(l.root+r.genome.scale,c,r.rythm[n]),j=l.chord.map((function(t){return t+r.genome.scale}));return Math.round(Math.random())<=2?(a.push({chord:r.notes[n].chord.map((function(t){return new B(t.hight,c,u)})),root:new B(r.notes[n].root.hight,c,u)}),a.push({chord:j.map((function(t){return new B(t,c+u,r.rythm[n]-u)})),root:new B(m.hight,c+u,r.rythm[n]-u)}),o.push(r.rythm[n]-u),o.push(u)):(a.push({chord:j.map((function(t){return new B(t,c,u)})),root:new B(m.hight,c,u)}),a.push({chord:r.notes[n].chord.map((function(t){return new B(t.hight,c+u,r.rythm[n]-u)})),root:new B(r.notes[n].root.hight,c+u,r.rythm[n]-u)}),o.push(u),o.push(r.rythm[n]-u)),c+=r.rythm[n],"continue"}o.push(r.rythm[n]),c+=r.rythm[n],a.push(r.notes[n])},u=0;u<this.rythm.length;u++)h(u);return[o,a]}},{key:"joinChord",value:function(t,e){for(var n=this,r=[],o=[],a=0,c=function(c){if(Math.random()<t&&c<n.rythm.length-1){var h=[].concat(Object(s.a)(n.notes[c].chord),Object(s.a)(n.notes[c+1].chord)),u=n.notes[c+Math.round(Math.random())].root,l=lt(h,u,n.genome.scale,e,n.notes[c].chord.length);return o.push({chord:l.map((function(t){return new B(t,a,n.rythm[c]+n.rythm[c+1])})),root:new B(u.hight,a,n.rythm[c]+n.rythm[c+1])}),r.push(n.rythm[c]+n.rythm[c+1]),a+=n.rythm[c]+n.rythm[c+1],c++,i=c,"continue"}r.push(n.rythm[c]),a+=n.rythm[c],o.push(n.notes[c]),i=c},i=0;i<this.rythm.length;i++)c(i);return[r,o]}}]),t}();function st(t){var e=t.reduce((function(t,e){return t+e}));return t.map((function(t){return t/e}))}function ht(t){for(var e=Math.random(),n=0,r=0;n<e;)n+=t[r],r++;return r-1}function ut(t,e,n,r){var o=Math.max(t.genome.scale,e.genome.scale),a=Math.min(t.genome.scale,e.genome.scale),c=Math.floor(Math.random()*(o-a))+a,i=t.transpose(c),h=e.transpose(c),u=function(t,e,n){var r=[],o=0,a=[t.map((function(t){return t.end})).sort(),e.map((function(t){return t.end})).sort()];for(;o<n;)for(var c=Math.round(Math.random()),i=0;i<a[c].length;i++){if(a[c][i]>o){r.push(a[c][i]-o),o=a[c][i];break}i===a[c].length-1&&(r.push(a[c][i]-o),o=a[c][i])}return r}(i.getAllNotes(),h.getAllNotes(),r),l=function(t,e){for(var n=[],r=0,o=function(o){var a=e[o];n.push({chord:a.chord.map((function(e){return new B(e,r,t[o])})),root:new B(a.root,r,t[o])}),r+=t[o]},a=0;a<t.length;a++)o(a);return n}(u,function(t,e,n,r,o,a){for(var c=0,i=[],h=function(h){var u=[c,c+n[h]],l=[];t.notes.forEach((function(t){return t.root.existsInWindow(u)?l.push(t.root):null})),e.notes.forEach((function(t){return t.root.existsInWindow(u)?l.push(t.root):null})),l=Object(s.a)(new Set(l));var m=Math.floor(Math.random()*l.length),j=l[m];l=[],e.notes.forEach((function(t){t.chord.forEach((function(t){return t.existsInWindow(u)?l.push(t):null}))})),t.notes.forEach((function(t){t.chord.forEach((function(t){return t.existsInWindow(u)?l.push(t):null}))}));var d=lt(l=Object(s.a)(new Set(l)),j,r,a,o);i.push({chord:d,root:j.hight}),c+=n[h]},u=0;u<n.length;u++)h(u);return i}(i,h,u,c,t.notes[0].chord.length,n)),m=new T(l,u,c);return new it({notes:l,rythm:u,genome:m})}function lt(t,e,n,r,o){for(var a=Q.major,c=(e.hight-n)%12,i=a.mode[a.notes.indexOf(c)],s=[],h=0,u=0;u<o;u++){var l=t[Math.floor(Math.random()*t.length)].hight;!s.includes(l)&&U[i].slice(0,r+Math.floor(h/(2*r))).includes((l-e.hight)%12)?(h=0,s.push(l)):(h++,u--)}return s}var mt=function(t){var e=t.updateGeneration,n=t.params,o=Object(j.b)(),a=Object(j.c)((function(t){return t.population}));return Object(r.jsx)(L.a,{variant:"contained",color:"primary",onClick:function(){o(S()),function(t,e,n,r){for(var o=[],a=0;a<t.length;a++){for(var c=st(t.map((function(t){return t.score}))),i=ht(c),s=ht(c),h=ut(t[i],t[s],e,r).mutate(e,n),u=1,l=0;l<o.length;l++)if(o[l].compare(h)){a--,u=0;break}1===u&&o.push(h)}return o}(a,n.jazziness,{min:n.windowmin,max:n.windowmax},n.progressionLength).map((function(t){return o(M(t))})),e()},children:"Evolve"})};var jt=function(){var t=Object(o.useState)(0),e=Object(h.a)(t,2),n=e[0],a=e[1],c=Object(o.useState)({populationSize:8,jazziness:5,numberOfNotes:4,progressionLength:4,windowmin:2,windowmax:6}),i=Object(h.a)(c,2),s=i[0],d=i[1],f=Object(o.useState)(120),b=Object(h.a)(f,2),p=b[0],g=b[1],O=Object(j.b)(),v=function(t){var e;"tempo"===t.target.name?(g(t.target.value),e=t.target.value,Z=e):d(Object(A.a)(Object(A.a)({},s),{},Object(z.a)({},t.target.name,t.target.value)))},y=function(){a(0),O(S()),function(t,e,n,r,o){for(var a=[],c=0;c<t;c++)a.push(ct(e,n,r,o));return a}(s.populationSize,s.jazziness,s.numberOfNotes,{min:s.windowmin,max:s.windowmax},s.progressionLength).map((function(t){return O(M(t))}))};return Object(o.useEffect)((function(){y()}),[s]),Object(r.jsx)(C.a,{children:Object(r.jsxs)(u.a,{children:[Object(r.jsx)(l.a,{children:Object(r.jsxs)("h2",{children:["Generation: ",n]})}),Object(r.jsxs)(l.a,{className:"p-5",children:[Object(r.jsx)(m.a,{children:Object(r.jsx)(I.a,{name:"tempo",label:"Tempo",type:"number",onChange:v,value:p})}),Object(r.jsx)(m.a,{children:Object(r.jsx)(I.a,{name:"progressionLength",label:"Progression Length",type:"number",onChange:v,value:s.progressionLength})}),Object(r.jsx)(m.a,{children:Object(r.jsx)(I.a,{name:"populationSize",label:"Population size",type:"number",onChange:v,value:s.populationSize})}),Object(r.jsx)(m.a,{children:Object(r.jsx)(I.a,{name:"jazziness",label:"Jazziness",type:"number",onChange:v,value:s.jazziness})}),Object(r.jsx)(m.a,{children:Object(r.jsx)(I.a,{name:"numberOfNotes",label:"Number of notes",type:"number",onChange:v,value:s.numberOfNotes})})]}),Object(r.jsxs)(l.a,{className:"p-5",children:[Object(r.jsx)(m.a,{children:Object(r.jsx)(I.a,{name:"windowmin",label:"Min note len",type:"number",onChange:v,value:s.windowmin})}),Object(r.jsx)(m.a,{children:Object(r.jsx)(I.a,{name:"windowmax",label:"Max note len",type:"number",onChange:v,value:s.windowmax})})]}),Object(r.jsxs)(l.a,{children:[Object(r.jsx)(L.a,{variant:"contained",color:"primary",onClick:y,children:"Restart"}),Object(r.jsx)(mt,{updateGeneration:function(){a(n+1)},params:s})]})]})})};var dt=function(){var t=Object(o.useState)(null),e=Object(h.a)(t,2),n=e[0],a=e[1],c=Object(j.c)((function(t){return t.population}));return Object(o.useEffect)((function(){c.length>1&&a(ut(c[0],c[1]))}),[c]),n?Object(r.jsx)(C.a,{children:Object(r.jsxs)(u.a,{children:[Object(r.jsx)(l.a,{className:"p-3",children:Object(r.jsx)(m.a,{children:Object(r.jsx)("h2",{children:"Debug"})})}),Object(r.jsx)(l.a,{className:"p-3",children:Object(r.jsx)("h4",{children:"Parent 1:"})}),Object(r.jsx)(l.a,{children:Object(r.jsx)(m.a,{style:{height:"300px"},children:Object(r.jsx)(k,{progression:c[0],index:0})})}),Object(r.jsx)(l.a,{className:"p-3",children:Object(r.jsx)("h4",{children:"Parent 2:"})}),Object(r.jsx)(l.a,{children:Object(r.jsx)(m.a,{style:{height:"300px"},children:Object(r.jsx)(k,{progression:c[1],index:1})})}),Object(r.jsx)(l.a,{className:"p-3",children:Object(r.jsx)("h4",{children:"Child:"})}),Object(r.jsx)(l.a,{children:Object(r.jsx)(m.a,{style:{height:"300px"},children:Object(r.jsx)(k,{progression:n})})})]})}):null},ft=(n(115),n(80)),bt=n(20),pt=n(81),gt=n(156),Ot=Object(pt.a)({palette:{type:"dark",primary:{main:"#c62828"},secondary:{main:"#181a1b"}}});function vt(){return Object(r.jsxs)(gt.a,{theme:Ot,children:[Object(r.jsx)(jt,{}),Object(r.jsx)(ft.a,{children:Object(r.jsxs)(bt.c,{children:[Object(r.jsx)(bt.a,{path:"/test",children:Object(r.jsx)(dt,{})}),Object(r.jsx)(bt.a,{path:"/",children:Object(r.jsx)(E,{})})]})})]})}vt.whyDidYouRender=!0;var yt=vt,xt=function(t){t&&t instanceof Function&&n.e(3).then(n.bind(null,160)).then((function(e){var n=e.getCLS,r=e.getFID,o=e.getFCP,a=e.getLCP,c=e.getTTFB;n(t),r(t),o(t),a(t),c(t)}))},wt=(n(117),n(46)),Mt=[],St=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Mt,e=arguments.length>1?arguments[1]:void 0;switch(e.type){case y:return[].concat(Object(s.a)(t),[e.payload.speciman]);case w:return[];case x:return t.map((function(t,n){return n!==e.payload.index?t:new it(Object(A.a)(Object(A.a)({},t),{},{score:e.payload.score}))}));default:return t}},Nt=Object(wt.b)({population:St}),kt=Object(wt.c)(Nt);i.a.render(Object(r.jsx)(a.a.StrictMode,{children:Object(r.jsx)(j.a,{store:kt,children:Object(r.jsx)(yt,{})})}),document.getElementById("root")),xt()},93:function(t,e,n){}},[[118,1,2]]]);
//# sourceMappingURL=main.ed698148.chunk.js.map